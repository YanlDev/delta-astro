---
// TurnitinForm.astro - Versión optimizada y corregida
---

<section
  id="formulario-turnitin"
  class="py-8 md:py-12 bg-slate-800 relative overflow-hidden"
>
  <!-- Elementos decorativos simplificados -->
  <div class="absolute inset-0 opacity-5">
    <div
      class="absolute top-1/4 -right-24 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply blur-2xl"
    >
    </div>
    <div
      class="absolute bottom-0 -left-24 w-72 h-72 bg-indigo-500 rounded-full mix-blend-multiply blur-2xl"
    >
    </div>
  </div>

  <div class="container mx-auto px-4 relative z-10 max-w-2xl">
    <!-- Encabezado compacto -->
    <div class="text-center mb-6 md:mb-8">
      <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-white mb-2">
        Revisión Turnitin
      </h2>
      <p class="text-gray-300 text-sm md:text-base">Reporte en 5 minutos</p>
      <div
        class="w-16 h-1 bg-gradient-to-r from-blue-600 to-indigo-600 mx-auto mt-4"
      >
      </div>
    </div>

    <!-- Indicador de pasos - Mejorado para móvil -->
    <div class="flex justify-center mb-6 md:mb-8">
      <div class="flex space-x-2 md:space-x-3">
        <div
          class="step-indicator active bg-blue-500 text-white w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-medium"
          data-step="1"
        >
          1
        </div>
        <div
          class="step-indicator bg-slate-700 text-gray-400 w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-medium"
          data-step="2"
        >
          2
        </div>
        <div
          class="step-indicator bg-slate-700 text-gray-400 w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-medium"
          data-step="3"
        >
          3
        </div>
        <div
          class="step-indicator bg-slate-700 text-gray-400 w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-medium"
          data-step="4"
        >
          4
        </div>
      </div>
    </div>

    <!-- Formulario por pasos - Container optimizado -->
    <div
      class="bg-slate-900 border border-slate-700 rounded-xl overflow-hidden"
    >
      <form id="turnitinForm">
        <!-- Contenedor principal de pasos -->
        <div
          id="steps-container"
          class="relative min-h-[400px] md:min-h-[500px]"
        >
          <!-- Paso 1: Información Personal -->
          <div
            class="form-step absolute inset-0 opacity-100 transform translate-x-0"
            data-step="1"
          >
            <div class="p-4 md:p-6">
              <h3
                class="text-base md:text-lg font-semibold text-white mb-4 md:mb-6 flex items-center"
              >
                <span
                  class="w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-full flex items-center justify-center text-xs md:text-sm mr-3"
                  >1</span
                >
                Información Personal
              </h3>

              <div class="space-y-3 md:space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Nombre Completo *</label
                  >
                  <input
                    type="text"
                    id="fullName"
                    name="fullName"
                    required
                    class="w-full px-3 md:px-4 py-2 md:py-3 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm md:text-base"
                    placeholder="Ej: Juan Carlos Pérez López"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >WhatsApp *</label
                  >
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    required
                    class="w-full px-3 md:px-4 py-2 md:py-3 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm md:text-base"
                    placeholder="999 888 777"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Email *</label
                  >
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full px-3 md:px-4 py-2 md:py-3 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm md:text-base"
                    placeholder="tu@email.com"
                  />
                </div>
              </div>
            </div>

            <!-- Botones fijos en la parte inferior -->
            <div
              class="absolute bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 p-4 md:p-6"
            >
              <button
                type="button"
                class="next-btn w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 md:py-3 rounded-lg transition-all opacity-50 cursor-not-allowed text-sm md:text-base"
                disabled
              >
                Continuar →
              </button>
            </div>
          </div>

          <!-- Paso 2: Tipo de Servicio -->
          <div
            class="form-step absolute inset-0 opacity-0 transform"
            data-step="2"
          >
            <div class="p-4 md:p-6 pb-20">
              <h3
                class="text-base md:text-lg font-semibold text-white mb-4 md:mb-6 flex items-center"
              >
                <span
                  class="w-6 h-6 md:w-8 md:h-8 bg-purple-500 rounded-full flex items-center justify-center text-xs md:text-sm mr-3"
                  >2</span
                >
                Selecciona tu servicio
              </h3>

              <div class="space-y-3 md:space-y-4">
                <button
                  type="button"
                  class="report-option w-full p-3 md:p-4 bg-slate-800 border-2 border-slate-600 rounded-lg text-left transition-all hover:border-blue-500"
                  data-value="unico"
                  data-files="1"
                >
                  <div class="flex justify-between items-center">
                    <div>
                      <div
                        class="text-white font-semibold text-sm md:text-base"
                      >
                        Reporte Único
                      </div>
                      <div class="text-gray-400 text-xs md:text-sm">
                        1 documento
                      </div>
                    </div>
                    <div class="text-xl md:text-2xl font-bold text-blue-400">
                      S/7
                    </div>
                  </div>
                </button>

                <button
                  type="button"
                  class="report-option w-full p-3 md:p-4 bg-slate-800 border-2 border-slate-600 rounded-lg text-left transition-all hover:border-purple-500 relative"
                  data-value="pack"
                  data-files="3"
                >
                  <div
                    class="absolute -top-2 -right-2 bg-pink-500 text-white px-2 py-1 rounded-full text-xs"
                  >
                    Más Popular
                  </div>
                  <div class="flex justify-between items-center">
                    <div>
                      <div
                        class="text-white font-semibold text-sm md:text-base"
                      >
                        Pack 3 Reportes
                      </div>
                      <div class="text-gray-400 text-xs md:text-sm">
                        3 documentos diferentes
                      </div>
                      <div class="text-green-400 text-xs font-medium">
                        Ahorro 28%
                      </div>
                    </div>
                    <div class="text-xl md:text-2xl font-bold text-purple-400">
                      S/15
                    </div>
                  </div>
                </button>
              </div>
            </div>

            <div
              class="absolute bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 p-4 md:p-6"
            >
              <div class="flex space-x-3 md:space-x-4">
                <button
                  type="button"
                  class="prev-btn flex-1 bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 md:py-3 rounded-lg transition-all text-sm md:text-base"
                >
                  ← Anterior
                </button>
                <button
                  type="button"
                  class="next-btn flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 md:py-3 rounded-lg transition-all opacity-50 cursor-not-allowed text-sm md:text-base"
                  disabled
                >
                  Continuar →
                </button>
              </div>
            </div>
          </div>

          <!-- Paso 3: Subir Documentos -->
          <div
            class="form-step absolute inset-0 opacity-0 transform"
            data-step="3"
          >
            <div class="p-4 md:p-6 pb-20">
              <h3
                class="text-base md:text-lg font-semibold text-white mb-4 md:mb-6 flex items-center"
              >
                <span
                  class="w-6 h-6 md:w-8 md:h-8 bg-green-500 rounded-full flex items-center justify-center text-xs md:text-sm mr-3"
                  >3</span
                >
                Subir <span id="file-count-text">documento</span>
              </h3>

              <div id="file-upload-container">
                <input
                  type="file"
                  id="documents"
                  name="documents"
                  accept=".doc,.docx,.pdf"
                  required
                  class="hidden"
                />
                <!-- AGREGAR ID="drop-zone" aquí -->
                <label
                  id="drop-zone"
                  for="documents"
                  class="file-drop-zone block w-full p-6 md:p-8 border-2 border-dashed border-slate-600 rounded-lg text-center cursor-pointer transition-all hover:border-blue-500 hover:bg-slate-800"
                >
                  <div class="text-3xl md:text-4xl mb-3 md:mb-4">📄</div>
                  <div class="text-white font-medium mb-2 text-sm md:text-base">
                    Toca para seleccionar <span id="files-needed">archivo</span>
                  </div>
                  <div class="text-gray-400 text-xs md:text-sm">
                    DOC, DOCX, PDF (máx. 10MB cada uno)
                  </div>
                </label>
              </div>

              <div id="files-preview" class="space-y-3 mt-4 hidden"></div>
            </div>

            <div
              class="absolute bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 p-4 md:p-6"
            >
              <div class="flex space-x-3 md:space-x-4">
                <button
                  type="button"
                  class="prev-btn flex-1 bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 md:py-3 rounded-lg transition-all text-sm md:text-base"
                >
                  ← Anterior
                </button>
                <button
                  type="button"
                  class="next-btn flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 md:py-3 rounded-lg transition-all opacity-50 cursor-not-allowed text-sm md:text-base"
                  disabled
                >
                  Continuar →
                </button>
              </div>
            </div>
          </div>

          <!-- Paso 4: Envío y Comprobante -->
          <div
            class="form-step absolute inset-0 opacity-0 transform"
            data-step="4"
          >
            <div
              class="p-4 md:p-6 pb-20 overflow-y-auto max-h-[400px] md:max-h-[500px]"
            >
              <h3
                class="text-base md:text-lg font-semibold text-white mb-4 md:mb-6 flex items-center"
              >
                <span
                  class="w-6 h-6 md:w-8 md:h-8 bg-yellow-500 rounded-full flex items-center justify-center text-xs md:text-sm mr-3"
                  >4</span
                >
                Finalizar
              </h3>

              <!-- Método de entrega -->
              <div class="mb-4 md:mb-6">
                <label class="block text-sm font-medium text-gray-300 mb-3"
                  >¿Cómo quieres recibir tu reporte?</label
                >
                <div class="space-y-3">
                  <button
                    type="button"
                    class="delivery-option w-full p-3 md:p-4 bg-slate-800 border-2 border-slate-600 rounded-lg text-left transition-all hover:border-green-500"
                    data-value="whatsapp"
                  >
                    <div class="flex items-center">
                      <div
                        class="w-8 h-8 md:w-10 md:h-10 bg-green-500 rounded-full flex items-center justify-center mr-3"
                      >
                        <span class="text-white text-sm md:text-base">📱</span>
                      </div>
                      <div>
                        <div
                          class="text-white font-medium text-sm md:text-base"
                        >
                          WhatsApp
                        </div>
                        <div class="text-gray-400 text-xs md:text-sm">
                          Más rápido
                        </div>
                      </div>
                    </div>
                  </button>

                  <button
                    type="button"
                    class="delivery-option w-full p-3 md:p-4 bg-slate-800 border-2 border-slate-600 rounded-lg text-left transition-all hover:border-blue-500"
                    data-value="email"
                  >
                    <div class="flex items-center">
                      <div
                        class="w-8 h-8 md:w-10 md:h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3"
                      >
                        <span class="text-white text-sm md:text-base">📧</span>
                      </div>
                      <div>
                        <div
                          class="text-white font-medium text-sm md:text-base"
                        >
                          Email
                        </div>
                        <div class="text-gray-400 text-xs md:text-sm">
                          Más formal
                        </div>
                      </div>
                    </div>
                  </button>
                </div>
              </div>

              <!-- Comprobante de pago -->
              <div id="payment-upload-container" class="hidden mb-4 md:mb-6">
                <label class="block text-sm font-medium text-gray-300 mb-3"
                  >Comprobante de pago</label
                >
                <input
                  type="file"
                  id="payment"
                  name="payment"
                  accept="image/*"
                  required
                  class="hidden"
                />
                <label
                  for="payment"
                  class="payment-drop-zone block w-full p-4 md:p-6 border-2 border-dashed border-slate-600 rounded-lg text-center cursor-pointer transition-all hover:border-pink-500 hover:bg-slate-800"
                >
                  <div class="text-2xl md:text-3xl mb-3">📷</div>
                  <div class="text-white font-medium mb-2 text-sm md:text-base">
                    Subir comprobante
                  </div>
                  <div class="text-gray-400 text-xs md:text-sm">
                    Captura de pantalla o foto
                  </div>
                </label>
                <div id="payment-preview" class="mt-3 hidden"></div>
              </div>

              <!-- Mensaje opcional -->
              <div class="mb-4 md:mb-6">
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Mensaje adicional (opcional)</label
                >
                <textarea
                  id="message"
                  name="message"
                  rows="3"
                  class="w-full px-3 md:px-4 py-2 md:py-3 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none text-sm md:text-base"
                  placeholder="¿Alguna instrucción especial?"></textarea>
              </div>
            </div>

            <div
              class="absolute bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 p-4 md:p-6"
            >
              <div class="flex space-x-3 md:space-x-4">
                <button
                  type="button"
                  class="prev-btn flex-1 bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 md:py-3 rounded-lg transition-all text-sm md:text-base"
                >
                  ← Anterior
                </button>
                <button
                  type="submit"
                  class="submit-btn flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 md:py-3 rounded-lg transition-all opacity-50 cursor-not-allowed text-sm md:text-base"
                  disabled
                >
                  Enviar Solicitud
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Resumen -->
    <div
      id="summary"
      class="mt-4 md:mt-6 bg-blue-900 border border-blue-700 rounded-lg p-3 md:p-4 hidden"
    >
      <h4 class="text-white font-medium mb-2 text-sm md:text-base">
        📋 Resumen de tu solicitud:
      </h4>
      <div id="summary-content" class="text-xs md:text-sm text-gray-300"></div>
    </div>
  </div>
  <!-- </section> -->

  <!-- Scripts -->
  <script type="module" src="/src/scripts/turnitin-form.js"></script>

  <style>
    /* Estilos optimizados y simplificados */
    #steps-container {
      position: relative;
      overflow: hidden;
    }

    .form-step {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      transition: all 0.3s ease-in-out;
      display: flex;
      display: block !important;
      flex-direction: column;
    }

    .form-step.active {
      opacity: 1;
      transform: translateX(0);
      z-index: 10;
    }

    .form-step.prev {
      opacity: 0;
      transform: translateX(-100%);
      z-index: 1;
    }

    .form-step.next {
      opacity: 0;
      transform: translateX(100%);
      z-index: 1;
    }

    .step-indicator.active {
      background-color: rgb(59 130 246) !important;
      color: white !important;
    }

    .step-indicator.completed {
      background-color: rgb(34 197 94) !important;
      color: white !important;
    }

    .report-option.selected,
    .delivery-option.selected {
      border-color: rgb(59 130 246) !important;
      background-color: rgba(29 78 216, 0.3) !important;
    }

    .file-item {
      background-color: rgba(30 41 59, 0.5);
      border: 1px solid rgb(71 85 105);
      border-radius: 0.5rem;
      padding: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Responsivo para móviles pequeños */
    @media (max-width: 640px) {
      #formulario-turnitin {
        padding-top: 1rem;
        padding-bottom: 1rem;
      }

      .container {
        padding-left: 1rem;
        padding-right: 1rem;
      }

      #steps-container {
        min-height: 350px;
      }

      .form-step > div:first-child {
        padding-bottom: 5rem; /* Espacio para botones fijos */
      }
      /* Agregar al final del <style> del componente */

      /* Scroll personalizado para preview de archivos */
      .max-h-48::-webkit-scrollbar {
        width: 6px;
      }

      .max-h-48::-webkit-scrollbar-track {
        background: rgba(71, 85, 105, 0.3);
        border-radius: 3px;
      }

      .max-h-48::-webkit-scrollbar-thumb {
        background: rgba(59, 130, 246, 0.5);
        border-radius: 3px;
      }

      .max-h-48::-webkit-scrollbar-thumb:hover {
        background: rgba(59, 130, 246, 0.7);
      }

      /* Para Firefox */
      .max-h-48 {
        scrollbar-width: thin;
        scrollbar-color: rgba(59, 130, 246, 0.5) rgba(71, 85, 105, 0.3);
      }
    }
  </style>
</section>
